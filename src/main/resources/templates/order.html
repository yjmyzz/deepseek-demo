<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>DeepSeek è®¢å•æŸ¥è¯¢</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <a href="/" class="back-btn">â† è¿”å›é¦–é¡µ</a>
    
    <div class="home-container">
        <div class="home-content">
            <div class="home-header">
                <h1>ğŸ“¦ DeepSeek è®¢å•æŸ¥è¯¢</h1>
                <p>é€šè¿‡AIæ™ºèƒ½æŸ¥è¯¢è®¢å•çŠ¶æ€ä¿¡æ¯</p>
                <div class="provider-info" id="providerInfo">
                    <span class="provider-badge" id="providerBadge">ğŸ–¥ï¸ æœ¬åœ° Ollama</span>
                </div>
            </div>
            
            <div class="main-content">
                <div class="form-container">
                    <div class="form-group">
                        <label class="form-label">ğŸ·ï¸ è®¢å•å· <span class="required">*</span></label>
                        <input type="text" 
                               id="orderNumber" 
                               name="orderNumber" 
                               class="form-input" 
                               placeholder="è¯·è¾“å…¥11ä½æ•°å­—è®¢å•å·" 
                               pattern="[0-9]{11}"
                               maxlength="11"
                               required>
                        <div class="form-hint">è¯·è¾“å…¥11ä½æ•°å­—è®¢å•å·ï¼Œä¾‹å¦‚ï¼š12345678901</div>
                    </div>
                    
                    <div class="button-group">
                        <button type="button" id="streamBtn" class="btn btn-primary" onclick="startStreamQuery()">
                            âš¡ å¼€å§‹æŸ¥è¯¢
                        </button>
                    </div>
                    
                    <!-- ç¤ºä¾‹è®¢å•å· -->
                    <div class="example-section">
                        <h3>ğŸ“‹ ç¤ºä¾‹è®¢å•å·</h3>
                        <div class="example-list">
                            <button class="example-btn" onclick="setOrderNumber('12345678901')">12345678901 (å·²å‘è´§)</button>
                            <button class="example-btn" onclick="setOrderNumber('12345678902')">12345678902 (å¾…ä»˜æ¬¾)</button>
                            <button class="example-btn" onclick="setOrderNumber('12345678903')">12345678903 (å·²å®Œæˆ)</button>
                            <button class="example-btn" onclick="setOrderNumber('12345678904')">12345678904 (å¤„ç†ä¸­)</button>
                            <button class="example-btn" onclick="setOrderNumber('12345678905')">12345678905 (å·²å–æ¶ˆ)</button>
                        </div>
                    </div>
                </div>
                
                <!-- æµå¼æŸ¥è¯¢ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
                <div id="streamResultContainer" class="result-container" style="display: none;">
                    <div class="result-title">
                        <span>âš¡</span>
                        æŸ¥è¯¢ç»“æœ
                    </div>
                    <div id="streamContent" class="result-content"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="copyright">
        Â© 2025 <a href="http://yjmyzz.cnblogs.com" target="_blank">è©ææ ‘ä¸‹çš„æ¨è¿‡</a> - DeepSeek Demo
    </div>

    <!-- å¼•å…¥é€šç”¨AIæµå¼å¤„ç†åº“ -->
    <script src="/js/ai-stream.js"></script>

    <script>
        // åˆ›å»ºAIæµå¼å¤„ç†å™¨å®ä¾‹
        const aiHandler = new AIStreamHandler({
            // è®¢å•æŸ¥è¯¢ç‰¹å®šé…ç½®
            endpoint: '/order/stream',
            
            // UIå…ƒç´ é…ç½®
            sendButton: document.getElementById('streamBtn'),
            resultContainer: document.getElementById('streamResultContainer'),
            resultContent: document.getElementById('streamContent'),
            scrollContainer: document.getElementById('streamContent'),
            
            // æŒ‰é’®æ–‡æœ¬é…ç½®
            buttonTexts: {
                default: 'âš¡ å¼€å§‹æŸ¥è¯¢',
                loading: 'æŸ¥è¯¢ä¸­...'
            },
            
            // çŠ¶æ€æ–‡æœ¬é…ç½®
            statusTexts: {
                connecting: 'æ­£åœ¨è¿æ¥æŸ¥è¯¢æœåŠ¡...',
                connected: 'è¿æ¥æˆåŠŸï¼Œæ­£åœ¨æŸ¥è¯¢...',
                error: 'æŸ¥è¯¢æœåŠ¡è¿æ¥é”™è¯¯ï¼Œè¯·é‡è¯•',
                complete: 'æŸ¥è¯¢å®Œæˆ'
            },
            
            // é”™è¯¯å¤„ç†é…ç½®
            showErrorInResult: false,
            errorMessage: 'æŸ¥è¯¢å¤±è´¥ï¼Œè¯·é‡è¯•',
            
            // è‡ªå®šä¹‰æ¶ˆæ¯å¤„ç†
            onMessage: function(data, handler) {
                // è®¢å•æŸ¥è¯¢åŠŸèƒ½ä½¿ç”¨ç®€å•çš„æ–‡æœ¬è¿½åŠ 
                handler.appendContent(data);
            },
            
            // é”™è¯¯å¤„ç†
            onError: function(event, handler) {
                console.error('è®¢å•æŸ¥è¯¢æµé”™è¯¯:', event);
                // åªæœ‰åœ¨è¿æ¥çœŸæ­£å¤±è´¥æ—¶æ‰æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                if (handler.eventSource && handler.eventSource.readyState === EventSource.CLOSED) {
                    handler.options.resultContent.textContent += '\næŸ¥è¯¢å¤±è´¥ï¼Œè¯·é‡è¯•';
                }
            },
            
            // å¼€å§‹å¤„ç†å›è°ƒ
            onStart: function(params) {
                console.log('å¼€å§‹è®¢å•æŸ¥è¯¢æµ:', params);
                // æ˜¾ç¤ºç»“æœå®¹å™¨
                AIUtils.showResultContainer('streamResultContainer', 'streamContent');
            },
            
            // ç»“æŸå¤„ç†å›è°ƒ
            onEnd: function() {
                console.log('è®¢å•æŸ¥è¯¢æµç»“æŸ');
            }
        });

        /**
         * è®¾ç½®è®¢å•å·
         */
        function setOrderNumber(orderNumber) {
            document.getElementById('orderNumber').value = orderNumber;
        }
        
        /**
         * å¼€å§‹æµå¼æŸ¥è¯¢
         */
        function startStreamQuery() {
            const orderNumber = document.getElementById('orderNumber').value.trim();
            
            if (!orderNumber) {
                alert('è¯·è¾“å…¥è®¢å•å·');
                return;
            }
            
            if (!/^\d{11}$/.test(orderNumber)) {
                alert('è®¢å•å·æ ¼å¼é”™è¯¯ï¼Œè¯·è¾“å…¥11ä½æ•°å­—');
                return;
            }
            
            // å¼€å§‹æµå¼æŸ¥è¯¢
            aiHandler.startStream({ orderNumber: orderNumber });
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('è®¢å•æŸ¥è¯¢é¡µé¢åŠ è½½å®Œæˆ');
            
            // è‡ªåŠ¨èšç„¦åˆ°è®¢å•å·è¾“å…¥æ¡†
            const input = document.getElementById('orderNumber');
            input.focus();
            
            // æ›´æ–°æä¾›å•†å¾½ç« 
            AIUtils.updateProviderBadge('providerBadge');
            
            // æ£€æŸ¥AIé…ç½®çŠ¶æ€
            const isConfigured = sessionStorage.getItem('aiConfigured') === 'true';
            if (!isConfigured) {
                alert('è¯·å…ˆåœ¨é¦–é¡µé€‰æ‹©AIæä¾›å•†åå†ä½¿ç”¨è®¢å•æŸ¥è¯¢åŠŸèƒ½');
                window.location.href = '/';
            }
        });
    </script>
</body>
</html> 