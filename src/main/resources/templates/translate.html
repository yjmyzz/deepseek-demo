<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>DeepSeek æ™ºèƒ½ç¿»è¯‘</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <a href="/" class="back-btn">â† è¿”å›é¦–é¡µ</a>
    
    <div class="home-container">
        <div class="home-content">
            <div class="home-header">
                <h1>ğŸŒ DeepSeek æ™ºèƒ½ç¿»è¯‘</h1>
                <p>åŸºäºAIçš„æ™ºèƒ½ç¿»è¯‘æœåŠ¡ï¼Œæ”¯æŒå¤šè¯­è¨€äº’è¯‘</p>
                <div class="provider-info" id="providerInfo">
                    <span class="provider-badge" id="providerBadge">ğŸ–¥ï¸ æœ¬åœ° Ollama</span>
                </div>
            </div>
            
            <div class="main-content">
                <div class="form-container">
                    <form id="translateForm">
                        <div class="form-group">
                            <label class="form-label">ğŸ“ è¾“å…¥æ–‡æœ¬</label>
                            <textarea name="text" 
                                      id="textInput"
                                      class="form-input" 
                                      placeholder="è¯·è¾“å…¥è¦ç¿»è¯‘çš„å†…å®¹..." 
                                      rows="4" 
                                      required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">ğŸ¯ ç›®æ ‡è¯­è¨€</label>
                            <select name="targetLang" id="targetLangSelect" class="form-select">
                                <option value="en">ğŸ‡ºğŸ‡¸ è‹±æ–‡</option>
                                <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                                <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æ–‡</option>
                                <option value="ko">ğŸ‡°ğŸ‡· éŸ©æ–‡</option>
                                <option value="fr">ğŸ‡«ğŸ‡· æ³•æ–‡</option>
                                <option value="de">ğŸ‡©ğŸ‡ª å¾·æ–‡</option>
                                <option value="es">ğŸ‡ªğŸ‡¸ è¥¿ç­ç‰™æ–‡</option>
                                <option value="ru">ğŸ‡·ğŸ‡º ä¿„æ–‡</option>
                            </select>
                        </div>
                        
                        <button type="submit" id="translateBtn" class="btn btn-primary">
                            ğŸ”„ å¼€å§‹ç¿»è¯‘
                        </button>
                    </form>
                </div>
                
                <div id="resultContainer" class="result-container" style="display: none;">
                    <div class="result-title">
                        <span>âœ¨</span>
                        ç¿»è¯‘ç»“æœ
                    </div>
                    <div id="resultContent" class="result-content"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="copyright">
        Â© 2025 <a href="http://yjmyzz.cnblogs.com" target="_blank">è©ææ ‘ä¸‹çš„æ¨è¿‡</a> - DeepSeek Demo
    </div>

    <!-- å¼•å…¥é€šç”¨AIæµå¼å¤„ç†åº“ -->
    <script src="/js/ai-stream.js"></script>

    <script>
        // åˆ›å»ºAIæµå¼å¤„ç†å™¨å®ä¾‹
        const aiHandler = new AIStreamHandler({
            // ç¿»è¯‘ç‰¹å®šé…ç½®
            endpoint: '/translate/stream',
            
            // UIå…ƒç´ é…ç½®
            sendButton: document.getElementById('translateBtn'),
            resultContainer: document.getElementById('resultContainer'),
            resultContent: document.getElementById('resultContent'),
            scrollContainer: document.getElementById('resultContainer'),
            
            // æŒ‰é’®æ–‡æœ¬é…ç½®
            buttonTexts: {
                default: 'ğŸ”„ å¼€å§‹ç¿»è¯‘',
                loading: 'ç¿»è¯‘ä¸­...'
            },
            
            // çŠ¶æ€æ–‡æœ¬é…ç½®
            statusTexts: {
                connecting: 'æ­£åœ¨è¿æ¥ç¿»è¯‘æœåŠ¡...',
                connected: 'è¿æ¥æˆåŠŸï¼Œæ­£åœ¨ç¿»è¯‘...',
                error: 'ç¿»è¯‘æœåŠ¡è¿æ¥é”™è¯¯ï¼Œè¯·é‡è¯•',
                complete: 'ç¿»è¯‘å®Œæˆ'
            },
            
            // é”™è¯¯å¤„ç†é…ç½®
            showErrorInResult: false,
            errorMessage: 'ç¿»è¯‘å¤±è´¥ï¼Œè¯·é‡è¯•',
            
            // è‡ªå®šä¹‰æ¶ˆæ¯å¤„ç†
            onMessage: function(data, handler) {
                // ç¿»è¯‘åŠŸèƒ½ä½¿ç”¨ç®€å•çš„æ–‡æœ¬è¿½åŠ 
                handler.appendContent(data);
            },
            
            // é”™è¯¯å¤„ç†
            onError: function(event, handler) {
                console.error('ç¿»è¯‘æµé”™è¯¯:', event);
                // åªæœ‰åœ¨è¿æ¥çœŸæ­£å¤±è´¥æ—¶æ‰æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                if (handler.eventSource && handler.eventSource.readyState === EventSource.CLOSED) {
                    handler.options.resultContent.textContent += '\nç¿»è¯‘å¤±è´¥ï¼Œè¯·é‡è¯•';
                }
            },
            
            // å¼€å§‹å¤„ç†å›è°ƒ
            onStart: function(params) {
                console.log('å¼€å§‹ç¿»è¯‘æµ:', params);
                // æ˜¾ç¤ºç»“æœå®¹å™¨
                AIUtils.showResultContainer('resultContainer', 'resultContent');
            },
            
            // ç»“æŸå¤„ç†å›è°ƒ
            onEnd: function() {
                console.log('ç¿»è¯‘æµç»“æŸ');
            }
        });

        /**
         * å¼€å§‹ç¿»è¯‘
         */
        function startTranslate() {
            const text = AIUtils.getInputValue('textInput');
            const targetLang = document.getElementById('targetLangSelect').value;
            
            if (!text) {
                alert('è¯·è¾“å…¥è¦ç¿»è¯‘çš„å†…å®¹');
                return;
            }
            
            // å¼€å§‹æµå¼ç¿»è¯‘
            aiHandler.startStream({ 
                text: text, 
                targetLang: targetLang 
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ç¿»è¯‘é¡µé¢åŠ è½½å®Œæˆ');
            
            // è‡ªåŠ¨èšç„¦åˆ°æ–‡æœ¬è¾“å…¥æ¡†
            const textarea = document.querySelector('#textInput');
            if (textarea) {
                textarea.focus();
            }
            
            // æ›´æ–°æä¾›å•†å¾½ç« 
            AIUtils.updateProviderBadge('providerBadge');
            
            // è¡¨å•æäº¤å¤„ç†
            const form = document.getElementById('translateForm');
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                startTranslate();
            });
        });
    </script>
</body>
</html> 