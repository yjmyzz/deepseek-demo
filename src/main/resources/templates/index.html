<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>DeepSeek Demo - AIåŠŸèƒ½æ¼”ç¤º</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="home-container">
        <div class="home-content">
            <div class="home-header">
                <h1>ğŸ¤– DeepSeek Demo</h1>
                <p>ä½“éªŒå¼ºå¤§çš„AIåŠŸèƒ½ï¼ŒåŒ…æ‹¬æ™ºèƒ½å¯¹è¯ã€è¯­è¨€ç¿»è¯‘å’Œå¤©æ°”æŸ¥è¯¢</p>
            </div>
            
            <!-- çŠ¶æ€æ¶ˆæ¯æ˜¾ç¤º - ç§»åˆ°è¡¨å•ä¸Šæ–¹ -->
            <div th:if="${param.success}" class="status-success">
                âœ… è®¾ç½®æˆåŠŸï¼
            </div>
            <div th:if="${param.error}" class="status-error">
                <div th:if="${param.error == 'missing_api_key'}">
                    âŒ è¯·ä¸ºè¿œç¨‹DeepSeekè¾“å…¥æœ‰æ•ˆçš„API Key
                </div>
                <div th:unless="${param.error == 'missing_api_key'}">
                    âŒ è®¾ç½®å¤±è´¥ï¼Œè¯·é‡è¯•
                </div>
            </div>
            
            <form th:action="@{/setApiKey}" method="post" class="api-key-form">
                <div class="form-group">
                    <label class="form-label">ğŸŒ AI æä¾›å•† <span class="required">*</span></label>
                    <div class="provider-options">
                        <label class="provider-option" id="ollamaOption">
                            <input type="radio" name="provider" value="ollama">
                            <div class="provider-icon">ğŸ–¥ï¸</div>
                            <div class="provider-name">æœ¬åœ° Ollama</div>
                            <div class="provider-desc">å¿«é€Ÿå…è´¹</div>
                        </label>
                        <label class="provider-option" id="deepseekOption">
                            <input type="radio" name="provider" value="deepseek">
                            <div class="provider-icon">â˜ï¸</div>
                            <div class="provider-name">è¿œç¨‹ DeepSeek</div>
                            <div class="provider-desc">åŠŸèƒ½å¼ºå¤§</div>
                        </label>
                    </div>
                    <div class="form-error" id="providerError" style="display: none;">
                        âš ï¸ è¯·é€‰æ‹©AIæä¾›å•†
                    </div>
                </div>
                
                <div class="form-group" id="apiKeyGroup" style="display: none;">
                    <label class="form-label">ğŸ”‘ API Key <span class="required">*</span></label>
                    <input type="password" 
                           name="apiKey" 
                           class="form-input" 
                           placeholder="è¯·è¾“å…¥ä½ çš„ DeepSeek API Key" 
                           id="apiKeyInput">
                    <div class="form-error" id="apiKeyError" style="display: none;">
                        âš ï¸ è¯·è¾“å…¥API Key
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary" id="submitBtn" disabled>å¼€å§‹ä½¿ç”¨</button>
            </form>
            
            <div class="features" id="features">
                <a th:href="@{/chat}" class="feature-card chat-card disabled-feature" id="chatCard" tabindex="-1" title="è¯·å…ˆé€‰æ‹©AIæä¾›å•†"> 
                    <span class="feature-icon">ğŸ’¬</span>
                    <div class="feature-title">æ™ºèƒ½å¯¹è¯</div>
                    <div class="feature-desc">ä¸AIè¿›è¡Œå®æ—¶æµå¼å¯¹è¯ï¼Œä½“éªŒæ™ºèƒ½äº¤äº’</div>
                </a>
                
                <a th:href="@{/translate}" class="feature-card translate-card disabled-feature" id="translateCard" tabindex="-1" title="è¯·å…ˆé€‰æ‹©AIæä¾›å•†">
                    <span class="feature-icon">ğŸŒ</span>
                    <div class="feature-title">è¯­è¨€ç¿»è¯‘</div>
                    <div class="feature-desc">åŸºäºAIçš„æ™ºèƒ½ç¿»è¯‘æœåŠ¡ï¼Œæ”¯æŒå¤šè¯­è¨€äº’è¯‘</div>
                </a>
                
                <a th:href="@{/weather}" class="feature-card weather-card disabled-feature" id="weatherCard" tabindex="-1" title="è¯·å…ˆé€‰æ‹©AIæä¾›å•†">
                    <span class="feature-icon">ğŸŒ¤ï¸</span>
                    <div class="feature-title">å¤©æ°”æŸ¥è¯¢</div>
                    <div class="feature-desc">é€šè¿‡AIè·å–åŸå¸‚å¤©æ°”ä¿¡æ¯ï¼Œæ™ºèƒ½å¤©æ°”åŠ©æ‰‹</div>
                </a>
                
                <a th:href="@{/order}" class="feature-card order-card disabled-feature" id="orderCard" tabindex="-1" title="è¯·å…ˆé€‰æ‹©AIæä¾›å•†">
                    <span class="feature-icon">ğŸ“¦</span>
                    <div class="feature-title">è®¢å•æŸ¥è¯¢</div>
                    <div class="feature-desc">é€šè¿‡AIæ™ºèƒ½æŸ¥è¯¢è®¢å•çŠ¶æ€ï¼Œæ”¯æŒæµå¼æŸ¥è¯¢</div>
                </a>
            </div>
        </div>
    </div>
    
    <div class="copyright">
        Â© 2025 <a href="http://yjmyzz.cnblogs.com" target="_blank">è©ææ ‘ä¸‹çš„æ¨è¿‡</a> - DeepSeek Demo
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // æ¢å¤AIä¾›åº”å•†é€‰æ‹©çŠ¶æ€
            const savedProvider = sessionStorage.getItem('selectedProvider');
            if (savedProvider) {
                const radio = document.querySelector(`input[name="provider"][value="${savedProvider}"]`);
                if (radio) {
                    radio.checked = true;
                }
            }
            const ollamaOption = document.getElementById('ollamaOption');
            const deepseekOption = document.getElementById('deepseekOption');
            const apiKeyInputField = document.getElementById('apiKeyInput');
            const apiKeyGroup = document.getElementById('apiKeyGroup');
            const submitBtn = document.getElementById('submitBtn');
            const providerError = document.getElementById('providerError');
            const apiKeyError = document.getElementById('apiKeyError');
            const form = document.querySelector('form');

            function updateFeatureCards() {
                const selectedProvider = document.querySelector('input[name="provider"]:checked');
                const chatCard = document.getElementById('chatCard');
                const translateCard = document.getElementById('translateCard');
                const weatherCard = document.getElementById('weatherCard');
                const orderCard = document.getElementById('orderCard');
                const isConfigured = sessionStorage.getItem('aiConfigured') === 'true';
                if (!selectedProvider || !isConfigured) {
                    [chatCard, translateCard, weatherCard, orderCard].forEach(card => {
                        card.classList.add('disabled-feature');
                    });
                } else {
                    [chatCard, translateCard, weatherCard, orderCard].forEach(card => {
                        card.classList.remove('disabled-feature');
                    });
                }
            }

            function updateFormVisibility() {
                const isConfigured = sessionStorage.getItem('aiConfigured') === 'true';
                if (isConfigured) {
                    apiKeyGroup.style.display = 'none';
                    submitBtn.style.display = 'none';
                } else {
                    const selectedProvider = document.querySelector('input[name="provider"]:checked');
                    if (selectedProvider && selectedProvider.value === 'deepseek') {
                        apiKeyGroup.style.display = '';
                        submitBtn.style.display = '';
                    } else {
                        apiKeyGroup.style.display = 'none';
                        submitBtn.style.display = '';
                    }
                }
            }

            function updateAll() {
                updateProviderSelection();
                validateForm();
                updateFeatureCards();
                updateFormVisibility();
            }

            function updateProviderSelection() {
                const selectedProvider = document.querySelector('input[name="provider"]:checked');
                
                ollamaOption.classList.remove('selected');
                deepseekOption.classList.remove('selected');
                
                if (selectedProvider && selectedProvider.value === 'ollama') {
                    ollamaOption.classList.add('selected');
                    apiKeyGroup.style.display = 'none';
                    apiKeyInputField.required = false;
                    apiKeyInputField.value = '';
                    apiKeyError.style.display = 'none';
                } else if (selectedProvider && selectedProvider.value === 'deepseek') {
                    deepseekOption.classList.add('selected');
                    apiKeyGroup.style.display = 'block';
                    apiKeyInputField.required = true;
                }
            }

            function validateForm() {
                const selectedProvider = document.querySelector('input[name="provider"]:checked');
                const apiKeyValue = apiKeyInputField.value.trim();
                
                let isValid = true;
                
                if (!selectedProvider) {
                    providerError.style.display = 'block';
                    isValid = false;
                } else {
                    providerError.style.display = 'none';
                }
                
                if (selectedProvider && selectedProvider.value === 'deepseek') {
                    if (!apiKeyValue) {
                        apiKeyError.style.display = 'block';
                        isValid = false;
                    } else {
                        apiKeyError.style.display = 'none';
                    }
                }
                
                // æ›´æ–°æäº¤æŒ‰é’®çŠ¶æ€
                submitBtn.disabled = !isValid;
                submitBtn.style.display = 'block'; // å§‹ç»ˆæ˜¾ç¤ºæŒ‰é’®
            }

            // ä¾›åº”å•†åˆ‡æ¢æ—¶ï¼Œæ¸…é™¤é…ç½®çŠ¶æ€å¹¶æ¢å¤è¡¨å•
            document.querySelectorAll('input[name="provider"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    sessionStorage.removeItem('aiConfigured');
                    sessionStorage.removeItem('selectedProvider');
                    updateAll();
                });
            });

            // API Keyè¾“å…¥æ—¶å®æ—¶éªŒè¯
            apiKeyInputField.addEventListener('input', function() {
                validateForm();
            });

            // è¡¨å•æäº¤
            form.addEventListener('submit', function(e) {
                const selectedProvider = document.querySelector('input[name="provider"]:checked');
                const apiKeyValue = apiKeyInputField.value.trim();
                if (!selectedProvider) {
                    e.preventDefault();
                    providerError.style.display = 'block';
                    return false;
                }
                if (selectedProvider.value === 'deepseek' && !apiKeyValue) {
                    e.preventDefault();
                    apiKeyError.style.display = 'block';
                    return false;
                }
                // è®¾ç½®é…ç½®çŠ¶æ€
                sessionStorage.setItem('aiConfigured', 'true');
                sessionStorage.setItem('selectedProvider', selectedProvider.value);
                updateFormVisibility();
                updateFeatureCards();
            });

            // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
            updateAll();
        });
    </script>
</body>
</html> 