<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>DeepSeek Demo - æ™ºèƒ½å¯¹è¯</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <a href="/" class="back-btn">â† è¿”å›é¦–é¡µ</a>
    
    <div class="home-container">
        <div class="home-content">
            <div class="home-header">
                <h1>ğŸ¤– DeepSeek Demo</h1>
                <p>ä¸AIè¿›è¡Œæ™ºèƒ½å¯¹è¯ï¼Œä½“éªŒæµå¼å“åº”</p>
                <div class="provider-info" id="providerInfo">
                    <span class="provider-badge" id="providerBadge">ğŸ–¥ï¸ æœ¬åœ° Ollama</span>
                </div>
            </div>
            
            <div class="chat-container">
                <div class="chat-messages" id="chatMessages">
                    <div class="message ai">
                        <div class="message-content">ä½ å¥½ï¼æˆ‘æ˜¯AIåŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ</div>
                    </div>
                </div>
                
                <div class="typing-indicator" id="typingIndicator">
                    AIæ­£åœ¨æ€è€ƒä¸­...
                </div>
                
                <div class="input-area">
                    <div class="input-group">
                        <input type="text" 
                               id="messageInput" 
                               class="message-input" 
                               placeholder="è¾“å…¥ä½ çš„é—®é¢˜..." 
                               onkeypress="handleKeyPress(event, sendMessage)">
                        <button class="send-btn" onclick="sendMessage()" id="sendBtn">
                            å‘é€
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="status" id="status"></div>
        </div>
    </div>
    
    <div class="copyright">
        Â© 2025 <a href="http://yjmyzz.cnblogs.com" target="_blank">è©ææ ‘ä¸‹çš„æ¨è¿‡</a> - DeepSeek Demo
    </div>

    <!-- å¼•å…¥é€šç”¨AIæµå¼å¤„ç†åº“ -->
    <script src="/js/ai-stream.js"></script>

    <script>
        // åˆ›å»ºAIæµå¼å¤„ç†å™¨å®ä¾‹
        const aiHandler = new AIStreamHandler({
            // èŠå¤©ç‰¹å®šé…ç½®
            endpoint: '/chat/stream',
            messageParam: 'message',
            
            // UIå…ƒç´ é…ç½®
            sendButton: document.getElementById('sendBtn'),
            statusElement: document.getElementById('status'),
            typingIndicator: document.getElementById('typingIndicator'),
            scrollContainer: document.getElementById('chatMessages'),
            
            // å¯ç”¨æ¶ˆæ¯è®¡æ•°å™¨ï¼ˆç”¨äºèŠå¤©åŠŸèƒ½ï¼‰
            enableMessageCounter: true,
            
            // æŒ‰é’®æ–‡æœ¬é…ç½®
            buttonTexts: {
                default: 'å‘é€',
                loading: 'å‘é€ä¸­...'
            },
            
            // çŠ¶æ€æ–‡æœ¬é…ç½®
            statusTexts: {
                connecting: 'æ­£åœ¨è¿æ¥...',
                connected: 'è¿æ¥æˆåŠŸï¼Œæ­£åœ¨æ¥æ”¶å›å¤...',
                error: 'è¿æ¥é”™è¯¯ï¼Œè¯·é‡è¯•',
                complete: 'å¯¹è¯å®Œæˆ'
            },
            
            // è‡ªå®šä¹‰æ¶ˆæ¯å¤„ç†ï¼ˆç”¨äºèŠå¤©åŠŸèƒ½ï¼‰
            onMessage: function(data, handler) {
                const messageId = handler.getCurrentMessageId();
                // ä½¿ç”¨å…¬å…±çš„æ™ºèƒ½ç©ºæ ¼å¤„ç†æ–¹æ³•
                handler.appendToChatMessage(data, messageId);
            },
            
            // é”™è¯¯å¤„ç†
            onError: function(event, handler) {
                console.error('èŠå¤©æµé”™è¯¯:', event);
            },
            
            // å¼€å§‹å¤„ç†å›è°ƒ
            onStart: function(params) {
                console.log('å¼€å§‹èŠå¤©æµ:', params);
                // æ˜¾ç¤ºè¾“å…¥æŒ‡ç¤ºå™¨
                handler.showTypingIndicator();
            },
            
            // ç»“æŸå¤„ç†å›è°ƒ
            onEnd: function() {
                console.log('èŠå¤©æµç»“æŸ');
            }
        });

        /**
         * å¤„ç†é”®ç›˜äº‹ä»¶
         */
        function handleKeyPress(event, callback) {
            AIUtils.handleKeyPress(event, callback);
        }

        /**
         * å‘é€æ¶ˆæ¯
         */
        function sendMessage() {
            const message = AIUtils.getInputValue('messageInput');
            
            if (!message) {
                console.log('æ¶ˆæ¯ä¸ºç©ºï¼Œä¸å‘é€');
                return;
            }
            
            if (aiHandler.isCurrentlyStreaming()) {
                console.log('æ­£åœ¨æµå¼ä¼ è¾“ä¸­ï¼Œå¿½ç•¥æ–°è¯·æ±‚');
                return;
            }
            
            console.log('å‘é€æ¶ˆæ¯:', message);
            
            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
            aiHandler.addMessage(message, 'user');
            AIUtils.clearInput('messageInput');
            
            // å¼€å§‹æµå¼å¯¹è¯
            aiHandler.startStream({ message: message });
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('èŠå¤©é¡µé¢åŠ è½½å®Œæˆ');
            
            // è‡ªåŠ¨èšç„¦åˆ°è¾“å…¥æ¡†
            const input = document.getElementById('messageInput');
            input.focus();
            
            // æ›´æ–°æä¾›å•†å¾½ç« 
            AIUtils.updateProviderBadge('providerBadge');
        });
    </script>
</body>
</html> 